#!/bin/sh
echo '🔍 Tikrinamas kodas prieš commit...'

# ✅ 1️⃣ Tikriname sintaksės klaidas
python -m py_compile modules/*.py
EXIT_CODE=$?
if [ -z "$EXIT_CODE" ]; then
    echo '⚠️ Įspėjimas: EXIT_CODE yra tuščias, nustatoma reikšmė 1'
    EXIT_CODE=1
fi
if [ "$EXIT_CODE" -ne 0 ]; then
    echo '❌ Klaida: Kodas turi sintaksės klaidų! Commit sustabdytas.'
    exit 1
fi
echo '✅ Kodas sintaksiškai teisingas.'

# ✅ 2️⃣ Vykdome automatinį testavimą
echo '🚀 Vykdomas unittest testavimas...'
PYTHONIOENCODING=utf-8 python -m unittest discover -s tests
TEST_EXIT_CODE=$?

if [ "$TEST_EXIT_CODE" -ne 0 ]; then
    echo '❌ Klaida: Testai nepraėjo! Commit sustabdytas.'
    exit 1
fi
echo '✅ Visi testai sėkmingai įvykdyti!'

exit 0
